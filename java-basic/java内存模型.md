## Java内存区域划分

因为Java程序最终运行在jvm上，所以这儿的内存区域指的是jvm上的内存区域划分。

## 包括哪些？

《JVM虚拟机规范》规定，包括以下几个部分。

1. 程序计数器
2. Java栈
3. 本地方法栈
4. 方法区
5. 堆

## 每个区分别存放什么数据？

### 程序计数器

程序计数器用于指示`执行哪一条指令`。在jvm中，多线程是通过线程轮流切换来获取cpu时间的，在一个具体时间，一个cpu内核只会执行一条线程中的指令。
因此，为了能让每个线程切换后都能恢复到切换前的指令，所以每个线程都需要有一个程序计数器。简单地说，就是程序计数器是线程私有的。
另外还有其他特性：

1. 线程执行非native方法，程序计数器指示的是当前需要执行的指令；如果是native方法，则为undefined
2. 由于程序计数器其本身占用的存储空间是固定的，所以程序计数器是不会抛出内存溢出的错误。其实它也是唯一不会抛出的内存区域。

### Java栈

Java栈是java方法执行的内存模型。Java栈存放的是一个个栈帧。每个栈帧有以下内容：

1. 局部变量表
2. 操作数栈
3. 运行时常量池的引用
4. 方法返回的地址
5. 附加信息

#### 局部变量表

用于存放方法中声明的局部变量，包括：方法内声明的变量及方法形参。基本类型存值，引用类型存引用。局部变量表在编译期间就已经确定其大小了，在运行期间则不会再变化了。

#### 操作数栈

表达式求值是通过操作数栈来实现的。比如`int a = b + c;`，其就是一个入栈和出栈的过程。实际上每条指令都可以看成是类似这样的数的操作。

#### 运行时常量池引用

在运行时，有可能用到类中的常量，所以必须有一个引用。

#### 方法返回的地址

在方法被调用之后，需要回到被调用的方法继续剩下的逻辑。

### 本地方法栈

使用`native`修饰的方法就是本地方法，而本地方法栈就是对此类方法执行的支持。虚拟机规范并没有强制限定其数据结构，虚拟机实现方可以自由定义。

### 方法区

方法区存放了类的元数据，被各个线程所共享。元数据可能包括以下数据：

1. 类信息，如：类名、字段信息、方法信息
2. 静态变量
3. 常量
4. 编译后的代码
5. 运行时常量池，用于存放编译期的字面值及符号引用。不过有时运行期也可以往常量池中添加内容，比如：`String.intern()`

### 堆

java堆用于存放new出来的东西，比如对象本身及数组。一般情况下，程序员不需要自己管理堆，而是通过java回收机制交由GC线程来进行回收。
堆也是所有线程共享的。